{"version":3,"sources":["../node_modules/@arcgis/core/layers/graphics/sources/FeatureLayerSource.js","../node_modules/@arcgis/core/layers/graphics/sources/support/clientSideDefaults.js"],"names":["F","Set","R","h","constructor","super","arguments","this","type","load","e","t","s","signal","addResolvingPromise","_fetchService","Promise","resolve","capabilities","query","supportsFormatPBF","parsedUrl","r","dynamicDataSource","a","gdbVersion","spatialReference","o","fieldsIndex","i","layer","u","f","url","path","format","sourceSpatialReference","attributes","objectIdField","_getLayerRequestOptions","_getFormDataForAttachment","c","body","_createFeatureEditResult","data","addAttachmentResult","_createAttachmentErrorResult","attachmentId","updateAttachmentResult","addFeatures","map","_serializeFeature","updateFeatures","_getFeatureIds","deleteFeatures","globalIdUsed","p","deleteAttachments","addAttachments","push","_serializeAttachment","updateAttachments","n","length","adds","updates","deletes","l","method","JSON","stringify","join","rollbackOnFailure","rollbackOnFailureEnabled","useGlobalIds","attachments","d","_createEditsResult","attachmentIds","deleteAttachmentResults","fetchRecomputedExtents","then","async","returnUpdates","layerId","id","extent","fullExtent","timeExtent","fromJSON","y","start","end","get","objectIds","all","parentObjectId","attachmentInfos","m","queryTask","executeAttachmentQuery","execute","customParameters","executeJSON","executeForIds","executeForCount","executeForExtent","executeRelationshipQuery","executeRelationshipQueryForCount","sourceJSON","returnAdvancedSymbols","_patchServiceJSON","has","geometryType","drawingInfo","renderer","defaultSymbol","g","geometry","toJSON","feature","attachment","globalId","name","contentType","uploadId","parentGlobalId","globalIdField","FileReader","readAsDataURL","onload","result","onerror","b","mediaType","File","_canUseGlobalIds","_getGlobalIdsFromFeatureIdentifier","_getObjectIdsFromFeatureIdentifier","_getIdsFromFeatures","objectId","addFeatureResults","addResults","updateFeatureResults","updateResults","deleteFeatureResults","deleteResults","addAttachmentResults","updateAttachmentResults","success","error","code","description","details","messages","message","httpStatus","messageCode","FormData","elements","set","append","source","responseType","prototype","constructOnly","readOnly","q","symbol","indexOf","Function"],"mappings":"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","file":"static/js/129.d01d2dd9.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/has.js\";import{fixJson as r}from\"../../../core/lang.js\";import{setDeepValue as a}from\"../../../core/object.js\";import{isSome as s,isNone as o}from\"../../../core/maybe.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as u}from\"../../../core/accessorSupport/decorators/subclass.js\";import n from\"../../../core/Error.js\";import{dataComponents as l}from\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import d from\"../../../geometry/Extent.js\";import c from\"../../../request.js\";import h from\"../../../core/Loadable.js\";import y from\"../../../TimeExtent.js\";import{unapplyEditsZUnitScaling as p}from\"../../../rest/query/operations/zscale.js\";import{processAttachmentQueryResult as m}from\"../../../rest/query/operations/queryAttachments.js\";import f from\"../../../tasks/QueryTask.js\";import{createDrawingInfo as g}from\"./support/clientSideDefaults.js\";async function b(e){if(\"string\"==typeof e){const t=l(e);return t||{data:e}}return new Promise(((t,r)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(l(a.result)),a.onerror=e=>r(e)}))}const F=new Set([\"Feature Layer\",\"Table\"]);let R=class extends h{constructor(){super(...arguments),this.type=\"feature-layer\"}load(e){const t=s(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(t)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:r,dynamicDataSource:a,gdbVersion:s,spatialReference:o,fieldsIndex:i}=this.layer,u=t(\"featurelayer-pbf\")&&e?\"pbf\":\"json\";return new f({url:r.path,format:u,fieldsIndex:i,dynamicDataSource:a,gdbVersion:s,sourceSpatialReference:o})}async addAttachment(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+r+\"/addAttachment\",s=this._getLayerRequestOptions(),o=this._getFormDataForAttachment(t,s.query);try{const e=await c(a,{body:o});return this._createFeatureEditResult(e.data.addAttachmentResult)}catch(i){throw this._createAttachmentErrorResult(r,i)}}async updateAttachment(e,t,r){await this.load();const a=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+\"/\"+a+\"/updateAttachment\",o=this._getLayerRequestOptions({query:{attachmentId:t}}),i=this._getFormDataForAttachment(r,o.query);try{const e=await c(s,{body:i});return this._createFeatureEditResult(e.data.updateAttachmentResult)}catch(u){throw this._createAttachmentErrorResult(a,u)}}async applyEdits(e,t){await this.load();const r=e.addFeatures.map(this._serializeFeature,this),a=e.updateFeatures.map(this._serializeFeature,this),s=this._getFeatureIds(e.deleteFeatures,null==t?void 0:t.globalIdUsed);p(r,a,this.layer.spatialReference);const o=[],i=[],u=[...e.deleteAttachments];for(const c of e.addAttachments)o.push(await this._serializeAttachment(c));for(const c of e.updateAttachments)i.push(await this._serializeAttachment(c));const n=o.length||i.length||u.length?{adds:o,updates:i,deletes:u}:null,l=this._getLayerRequestOptions({method:\"post\",query:{adds:r.length?JSON.stringify(r):null,updates:a.length?JSON.stringify(a):null,deletes:s.length?null!=t&&t.globalIdUsed?JSON.stringify(s):s.join(\",\"):null,gdbVersion:(null==t?void 0:t.gdbVersion)||this.layer.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,attachments:n&&JSON.stringify(n)}}),d=await c(this.layer.parsedUrl.path+\"/applyEdits\",l);return this._createEditsResult(d)}async deleteAttachments(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+r+\"/deleteAttachments\";try{return(await c(a,this._getLayerRequestOptions({query:{attachmentIds:t.join(\",\")},method:\"post\"}))).data.deleteAttachmentResults.map(this._createFeatureEditResult)}catch(s){throw this._createAttachmentErrorResult(r,s)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then((async()=>{const t=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:r,url:a}=this.layer,{data:s}=await c(`${a}/${r}`,t),{id:o,extent:i,fullExtent:u,timeExtent:n}=s,l=i||u;return{id:o,fullExtent:l&&d.fromJSON(l),timeExtent:n&&y.fromJSON({start:n[0],end:n[1]})}}))}async queryAttachments(e,t={}){const{parsedUrl:r}=this.layer,a=r.path;await this.load();const s=this._getLayerRequestOptions(t);if(!this.layer.get(\"capabilities.operations.supportsQueryAttachments\")){const{objectIds:t}=e,r=[];for(const e of t){const t=a+\"/\"+e+\"/attachments\";r.push(c(t,s))}return Promise.all(r).then((e=>t.map(((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))))).then((e=>m(e,a)))}return this.queryTask.executeAttachmentQuery(e,s)}async queryFeatures(e,t){return await this.load(),this.queryTask.execute(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async _fetchService(e){let r=this.layer.sourceJSON;if(!r){const{data:a}=await c(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:t(\"featurelayer-advanced-symbols\")?{returnAdvancedSymbols:!0}:{},signal:e}));r=a}this.sourceJSON=this._patchServiceJSON(r);const a=r.type;if(!F.has(a))throw new n(\"feature-layer-source:unsupported-type\",`Source type \"${a}\" is not supported`)}_patchServiceJSON(e){var t;if(\"Table\"!==e.type&&e.geometryType&&(null==e||null==(t=e.drawingInfo)||!t.renderer)&&!e.defaultSymbol){const t=g(e.geometryType).renderer;a(\"drawingInfo.renderer\",t,e)}return e}_serializeFeature(e){const{geometry:t,attributes:r}=e;return o(t)?{attributes:r}:\"mesh\"===t.type||\"extent\"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:a,name:s,contentType:o,data:i,uploadId:u}=r,n={globalId:a,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(n.parentGlobalId=\"attributes\"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),u)n.uploadId=u;else if(i){const e=await b(i);n.contentType=e.mediaType,n.data=e.data,i instanceof File&&(n.name=i.name)}return s&&(n.name=s),o&&(n.contentType=o),n}_getFeatureIds(e,t){const r=e[0];return r?this._canUseGlobalIds(t,e)?this._getGlobalIdsFromFeatureIdentifier(e):\"objectId\"in r?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map((e=>e.attributes&&e.attributes[t]))}_canUseGlobalIds(e,t){return e&&\"globalId\"in t[0]}_getObjectIdsFromFeatureIdentifier(e){return e.map((e=>e.objectId))}_getGlobalIdsFromFeatureIdentifier(e){return e.map((e=>e.globalId))}_createEditsResult(e){const t=e.data,r=e.data&&e.data.attachments;return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:r&&r.addResults?r.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:r&&r.updateResults?r.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:r&&r.deleteResults?r.deleteResults.map(this._createFeatureEditResult,this):[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new n(\"feature-layer-source:edit-failure\",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,a=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new n(\"feature-layer-source:attachment-failure\",r,{code:a})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const a in t){const e=t[a];null!=e&&(r.set?r.set(a,e):r.append(a,e))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:a,dynamicDataSource:s}=this.layer;return{...e,query:r({gdbVersion:a,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:\"json\",...this.layer.customParameters,...null==e?void 0:e.query}),responseType:\"json\"}}};e([i()],R.prototype,\"type\",void 0),e([i({constructOnly:!0})],R.prototype,\"layer\",void 0),e([i({readOnly:!0})],R.prototype,\"queryTask\",null),R=e([u(\"esri.layers.graphics.sources.FeatureLayerSource\")],R);var q=R;export default q;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport t from\"../../../../core/has.js\";import{clone as r}from\"../../../../core/lang.js\";import{defaultPointSymbolJSON as e,defaultPolylineSymbolJSON as n,defaultPolygonSymbolJSON as o}from\"../../../../symbols/support/defaultsJSON.js\";function i(t){return{renderer:{type:\"simple\",symbol:\"esriGeometryPoint\"===t||\"esriGeometryMultipoint\"===t?e:\"esriGeometryPolyline\"===t?n:o}}}function s(r,e){if(t(\"csp-restrictions\"))return()=>({[e]:null,...r});try{let t=`this.${e} = null;`;for(const e in r){t+=`this${e.indexOf(\".\")?`[\"${e}\"]`:`.${e}`} = ${JSON.stringify(r[e])};`}const n=new Function(t);return()=>new n}catch(n){return()=>({[e]:null,...r})}}function u(t={}){return[{name:\"New Feature\",description:\"\",prototype:{attributes:r(t)}}]}export{s as createDefaultAttributesFunction,u as createDefaultTemplate,i as createDrawingInfo};\n"],"sourceRoot":""}